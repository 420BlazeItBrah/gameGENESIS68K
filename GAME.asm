	INCLUDE 'INCLUDES.ASM'	
		
ROM_START	
	
RESET
	BSR WRITE_TMSS_TO_VDP
	BSR LOAD_VDP_REGISTERS		
	BSR INIT_CONTROLLERS
	BSR z80_loadDriver	

	MOVE.B #$01, LEVEL
	MOVE.W #$00, EXP		
	
	;https://www.copetti.org/writings/consoles/mega-drive-genesis/
		
	DRAW_STRING #UI_LEVEL, VDP_PLANEA_L11_ADDR
	DRAW_STRING #UI_EXP, VDP_PLANEA_L21_ADDR
	DRAW_STRING #UI_TEST, VDP_PLANEA_L31_ADDR

	ADD_PALETTE CRAM_PALETTE0, PALETTE_FONT					
	ADD_PALETTE CRAM_PALETTE1, PALETTE_SPRITE_GIMMICK		
	ADD_PALETTE CRAM_PALETTE2, PALETTE_SPRITE_REDMONSTER	
	ADD_PALETTE CRAM_PALETTE3, PALETTE_SPRITE_ALIEN			
	
	ADD_GRAPHICS GRAPHICS_FONT, GRAPHICS_FONT_END
	ADD_GRAPHICS GRAPHICS_REDMONSTER, GRAPHICS_REDMONSTER_END
	ADD_GRAPHICS GRAPHICS_ALIEN, GRAPHICS_ALIEN_END
	ADD_GRAPHICS GRAPHICS_GIMMICK, GRAPHICS_GIMMICK_END
	ADD_GRAPHICS GRAPHICS_FLOOR, GRAPHICS_FLOOR_END
		
	ADD_SPRITE 0x00A0, 0x00A0, D2x2, TILE_GIMMICK, PALETTE1, 0x0002, 0x0004
	ADD_SPRITE 0x00C5, 0x00B0, D2x2, TILE_REDMONSTER, PALETTE2, 0x0006, 0x0001
	ADD_SPRITE 0x00E0, 0x00C5, D2x2, TILE_REDMONSTER, PALETTE2, 0x0004, 0x0004
	ADD_SPRITE 0x0105, 0x00AF, D2x2, TILE_GIMMICK, PALETTE1+VFLIP, 0x0004, 0x0004
	ADD_SPRITE 0x0120, 0x00CD, D2x2, TILE_GIMMICK, PALETTE1, 0x0004, 0x0004
	ADD_SPRITE 0x0145, 0x00BF, D2x2, TILE_GIMMICK, PALETTE1, 0x0004, 0x0004
	ADD_SPRITE 0x0160, 0x0112, D2x2, TILE_GIMMICK, PALETTE1+HFLIP, 0x0004, 0x0004
	ADD_SPRITE 0x0185, 0x0134, D2x2, TILE_GIMMICK, PALETTE1, 0x0004, 0x0004
	
	ADD_SPRITE 0x00A0, 0x00C0, D2x2, TILE_GIMMICK, PALETTE1, 0x0002, 0x0002
	ADD_SPRITE 0x00C5, 0x00C0, D2x2, TILE_REDMONSTER, PALETTE2, 0x0003, 0x0002
	ADD_SPRITE 0x00E0, 0x00C0, D2x2, TILE_REDMONSTER, PALETTE2, 0x0002, 0x0003
	ADD_SPRITE 0x0105, 0x00C0, D2x2, TILE_GIMMICK, PALETTE1+VFLIP, 0x0003, 0x0002
	ADD_SPRITE 0x0120, 0x00C0, D2x2, TILE_GIMMICK, PALETTE1, 0x0001, 0x0003
	ADD_SPRITE 0x0145, 0x00C0, D2x2, TILE_GIMMICK, PALETTE1, 0x0003, 0x0004
	ADD_SPRITE 0x0160, 0x00C0, D2x2, TILE_GIMMICK, PALETTE1+HFLIP, 0x0002, 0x0001
	ADD_SPRITE 0x0185, 0x00C0, D2x2, TILE_GIMMICK, PALETTE1, 0x0003, 0x0001
	
	ADD_SPRITE 0x00A0, 0x00E0, D2x2, TILE_GIMMICK, PALETTE1, 0x0002, 0x0002
	ADD_SPRITE 0x00C5, 0x00E0, D2x2, TILE_REDMONSTER, PALETTE2, 0x0003, 0x0002
	ADD_SPRITE 0x00E0, 0x00E0, D2x2, TILE_REDMONSTER, PALETTE2, 0x0002, 0x0003
	ADD_SPRITE 0x0105, 0x00E0, D2x2, TILE_GIMMICK, PALETTE1+VFLIP, 0x0003, 0x0002
	ADD_SPRITE 0x0120, 0x00E0, D2x2, TILE_GIMMICK, PALETTE1, 0x0001, 0x0003
	ADD_SPRITE 0x0145, 0x00E0, D2x2, TILE_GIMMICK, PALETTE1, 0x0003, 0x0004
	ADD_SPRITE 0x0160, 0x00E0, D2x2, TILE_GIMMICK, PALETTE1+HFLIP, 0x0002, 0x0001
	ADD_SPRITE 0x0185, 0x00E0, D2x2, TILE_GIMMICK, PALETTE1, 0x0003, 0x0001
	
	ADD_SPRITE 0x010A, 0x0106, D2x2, TILE_GIMMICK, PALETTE1, 0x0006, 0x000D
	ADD_SPRITE 0x011C, 0x0126, D2x2, TILE_GIMMICK, PALETTE1, 0x0001, 0x0003
	ADD_SPRITE 0x012C, 0x0116, D2x2, TILE_GIMMICK, PALETTE1, 0x0001, 0x0002
	ADD_SPRITE 0x013C, 0x0136, D2x2, TILE_GIMMICK, PALETTE1, 0x0003, 0x0003
	ADD_SPRITE 0x014C, 0x010B, D2x2, TILE_GIMMICK, PALETTE1, 0x0002, 0x0002
	ADD_SPRITE 0x015C, 0x010A, D2x2, TILE_GIMMICK, PALETTE1, 0x0003, 0x0003
	ADD_SPRITE 0x016C, 0x009B, D2x2, TILE_GIMMICK, PALETTE1, 0x0002, 0x0005  
	
	;ADD_SPRITE 0x0EA, 0x0106, D2x2, TILE_GIMMICK, PALETTE1, 0x000D, 0x0006
	;ADD_SPRITE 0x0DC, 0x0126, D2x2, TILE_GIMMICK, PALETTE1, 0x0003, 0x0001
	;ADD_SPRITE 0x0BC, 0x0116, D2x2, TILE_GIMMICK, PALETTE1, 0x0002, 0x0001
	;ADD_SPRITE 0x0AC, 0x0136, D2x2, TILE_GIMMICK, PALETTE1, 0x0003, 0x0003
	;ADD_SPRITE 0x09C, 0x010B, D2x2, TILE_GIMMICK, PALETTE1, 0x0002, 0x0002
	;ADD_SPRITE 0x08C, 0x010A, D2x2, TILE_GIMMICK, PALETTE1, 0x0003, 0x0003
	;ADD_SPRITE 0x08C, 0x009F, D2x2, TILE_GIMMICK, PALETTE1, 0x0005, 0x0002
	;ADD_SPRITE 0x08C, 0x0174, D2x2, TILE_GIMMICK, PALETTE1, 0x0002, 0x0003
	
	;ADD_SPRITE 0x08C, 0x0092, D2x2, TILE_GIMMICK, PALETTE1, 0x0005

	DRAW_LEVEL MAP_WORLD1
	move.w #$8B00,vdp_control
	move.w #$8D34,vdp_control

	MOVE.W #$2300, SR
	
	LEA XGMsong, A1	
	BSR xgm_startPlayMusic	
	MOVE.B #$01, XGM_READY
		
GAME_LOOP:    		
	BRA GAME_LOOP
	RTS
	
CHECK_CONTROLS:
UP:
	BTST #pad_button_up, D0
	BEQ DOWN	
	
DOWN:	
	BTST #pad_button_down, D0
	BEQ LEFT	
	
LEFT:
	BTST #pad_button_left, D0
	BEQ RIGHT
	

RIGHT:
	BTST #pad_button_right, D0
	BEQ A
	
A:
	BTST #pad_button_a, D0
	BEQ B
	
	

	;BSR xgm_stopPlayMusic

B:
	BTST #pad_button_b, D0
	BEQ DONE
	;BSR xgm_resumePlayMusic

DONE:
	RTS


INT_VBLANK:

	BSR VINT_UPDATESPRITEPOSITIONS
	BSR VINT_CHECKCOLLISION_BOUNDRIES
	BSR READ_CONTROLLER_A_LATCH	
	BSR CHECK_CONTROLS  	
	BSR VINT_XGMPLAYBACK
	
	move.L #$50000003,VDP_CONTROL
	move.w (HORIZONTAL_SCROLL_OFFSET),VDP_DATA

	ADDQ #$01, HORIZONTAL_SCROLL_OFFSET

	;BSR xgm_resumePlayMusic
  RTE
	
INT_HBLANK:
    RTE

INT_NULL:
    RTE

CPU_EXCEPTION:
    STOP   #$2700
    RTE 

	INCLUDE 'INCBINS.ASM'
	
ROM_END

;910
;257
;6886
